<div class="overflow-hidden bg-white shadow sm:rounded-lg mt-10">
  <div class="px-4 py-5 sm:p-6">
    <h1 class="text-2xl font-bold"><%= @link.title %></h1>
    <div class="relative flex items-center space-x-3 bg-white py-4">
      <div class="flex-shrink-0">
        <%= image_tag @link.icon_url, class: 'h-10 w-10 rounded-full' %>
      </div>
      <div class="min-w-0 flex-1">
        <div>
          <%= link_to "#{@link.short_url_full.to_s}", @link.short_url_full, class: 'text-sm font-medium text-blue-600 visited:text-purple-600' %>
          <p class="truncate text-sm text-gray-500"><%= @link.original_url %></p>
        </div>
      </div>
    </div>
    <div class="relative">
      <div class="absolute inset-0 flex items-center" aria-hidden="true">
        <div class="w-full border-t border-gray-300"></div>
      </div>
    </div>
    <p class="text-xs text-gray-400 mt-4"><%= @link.created_at.strftime("%B %d, %Y %I:%M %p GMT%z") %></p>
  </div>
</div>

<div class="relative py-4">
  <div class="absolute inset-0 flex items-center" aria-hidden="true">
    <div class="w-full border-t border-gray-300"></div>
  </div>
  <div class="relative flex justify-center">
    <span class="bg-gray-100 px-3 text-base font-semibold leading-6 text-gray-900">Clicks engagements last 30 days</span>
  </div>
</div>

<div class="overflow-hidden bg-white shadow sm:rounded-lg">
  <div class="px-4 py-5 sm:p-6">
    <%= line_chart @link.daily_click_count(30.days.ago),
      adapter: "chartjs",
      xtitle: "Date", 
      ytitle: "Number of Clicks", 
      height: "500px", 
      colors: ["#3c8dbc"],
      min: 0,
      library: { 
        title: { text: "Clicks in the Past 30 Days" },
        xAxis: { type: 'datetime', dateTimeLabelFormats: { day: '%e %b' } },
        yAxis: { title: { text: "Number of Clicks" } }
      } 
    %>
  </div>
</div>

<div class="relative py-4">
  <div class="absolute inset-0 flex items-center" aria-hidden="true">
    <div class="w-full border-t border-gray-300"></div>
  </div>
  <div class="relative flex justify-center">
    <span class="bg-gray-100 px-3 text-base font-semibold leading-6 text-gray-900">Locations</span>
  </div>
</div>

<div class="overflow-x-auto bg-white shadow sm:rounded-lg">
  <div id="regions_div" class="w-full p-8"></div>
  <script id="geo-chart-data" type="application/json">
    <%= raw @link.click_count_by_country.to_json %>
  </script>
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Country</th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Number of Clicks</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      <% @link.click_count_by_country.each do |link_stats| %>
        <tr>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= country_name(link_stats[:country]) %></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= link_stats[:visits] %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<div class="relative py-4">
  <div class="absolute inset-0 flex items-center" aria-hidden="true">
    <div class="w-full border-t border-gray-300"></div>
  </div>
  <div class="relative flex justify-center">
    <span class="bg-gray-100 px-3 text-base font-semibold leading-6 text-gray-900">Clicks detail</span>
  </div>
</div>

<div class="overflow-x-auto bg-white shadow sm:rounded-lg mb-10">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50">
      <tr>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Originated location </th>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Timestamp</th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      <% @link.visits.each do |visit| %>
        <tr>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= country_name(visit.country) %></td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900"><%= visit.timestamp.strftime("%B %d, %Y %I:%M %p GMT%z") %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
